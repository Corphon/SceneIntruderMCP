{{define "user_profile.html"}}
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áî®Êà∑Ê°£Ê°à | Scene Intruder</title>

    <!-- Ê†∑ÂºèÊñá‰ª∂ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">

    <!-- ÂõæË°®Â∫ì -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- ÂØºËà™Ê†è -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-person-circle"></i>
                Scene Intruder
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">È¶ñÈ°µ</a>
                <a class="nav-link" href="/scenes">Âú∫ÊôØ</a>
                <a class="nav-link" href="/scenes/create">ÂàõÂª∫</a>
                <a class="nav-link active" href="/user/profile">Áî®Êà∑Ê°£Ê°à</a>
                <a class="nav-link" href="/settings">ËÆæÁΩÆ</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- È°µÈù¢Ê†áÈ¢ò -->
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 class="h3 mb-0">Áî®Êà∑Ê°£Ê°à</h1>
                        <p class="text-muted mb-0">ÁÆ°ÁêÜ‰Ω†ÁöÑÈÅìÂÖ∑„ÄÅÊäÄËÉΩÂíåÊàêÂ∞±</p>
                    </div>
                    <div class="profile-actions">
                        <button type="button" class="btn btn-outline-primary" onclick="refreshProfile()">
                            <i class="bi bi-arrow-clockwise"></i>
                            Âà∑Êñ∞
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="exportProfile()">
                            <i class="bi bi-download"></i>
                            ÂØºÂá∫
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Áî®Êà∑‰ø°ÊÅØÊ¶ÇËßà -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card user-info-card">
                    <div class="card-body text-center">
                        <div class="user-avatar mb-3">
                            <i class="bi bi-person-circle display-1 text-primary"></i>
                        </div>
                        <h5 class="card-title" id="user-name">Áî®Êà∑</h5>
                        <p class="text-muted" id="user-id">ID: user_default</p>
                        <div class="user-stats mt-3">
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="stat-value" id="total-items">0</div>
                                    <div class="stat-label">ÈÅìÂÖ∑</div>
                                </div>
                                <div class="col-4">
                                    <div class="stat-value" id="total-skills">0</div>
                                    <div class="stat-label">ÊäÄËÉΩ</div>
                                </div>
                                <div class="col-4">
                                    <div class="stat-value" id="total-achievements">0</div>
                                    <div class="stat-label">ÊàêÂ∞±</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="profile-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="tab" href="#items-tab">
                                    <i class="bi bi-bag"></i> ÈÅìÂÖ∑ÁÆ°ÁêÜ
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#skills-tab">
                                    <i class="bi bi-lightning"></i> ÊäÄËÉΩÈÖçÁΩÆ
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#achievements-tab">
                                    <i class="bi bi-trophy"></i> ÊàêÂ∞±Â±ïÁ§∫
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <!-- ÈÅìÂÖ∑ÁÆ°ÁêÜÊ†áÁ≠æÈ°µ -->
                            <div class="tab-pane fade show active" id="items-tab">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="mb-0">ÊàëÁöÑÈÅìÂÖ∑</h6>
                                    <button type="button" class="btn btn-sm btn-primary" onclick="showAddItemModal()">
                                        <i class="bi bi-plus"></i> Ê∑ªÂä†ÈÅìÂÖ∑
                                    </button>
                                </div>

                                <!-- ÈÅìÂÖ∑Á≠õÈÄâ -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <select class="form-select" id="item-category-filter">
                                            <option value="">ÊâÄÊúâÁ±ªÂà´</option>
                                            <option value="weapon">Ê≠¶Âô®</option>
                                            <option value="armor">Èò≤ÂÖ∑</option>
                                            <option value="accessory">È•∞ÂìÅ</option>
                                            <option value="consumable">Ê∂àËÄóÂìÅ</option>
                                            <option value="tool">Â∑•ÂÖ∑</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <select class="form-select" id="item-rarity-filter">
                                            <option value="">ÊâÄÊúâÁ®ÄÊúâÂ∫¶</option>
                                            <option value="common">ÊôÆÈÄö</option>
                                            <option value="uncommon">‰∏çÂ∏∏ËßÅ</option>
                                            <option value="rare">Á®ÄÊúâ</option>
                                            <option value="epic">Âè≤ËØó</option>
                                            <option value="legendary">‰º†ËØ¥</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- ÈÅìÂÖ∑ÂàóË°® -->
                                <div id="items-container" class="items-grid">
                                    <div class="text-center p-4">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Âä†ËΩΩ‰∏≠...</span>
                                        </div>
                                        <p class="mt-2 text-muted">Ê≠£Âú®Âä†ËΩΩÈÅìÂÖ∑...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- ÊäÄËÉΩÈÖçÁΩÆÊ†áÁ≠æÈ°µ -->
                            <div class="tab-pane fade" id="skills-tab">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="mb-0">ÊàëÁöÑÊäÄËÉΩ</h6>
                                    <button type="button" class="btn btn-sm btn-primary" onclick="showAddSkillModal()">
                                        <i class="bi bi-plus"></i> Ê∑ªÂä†ÊäÄËÉΩ
                                    </button>
                                </div>

                                <!-- ÊäÄËÉΩÁ≠õÈÄâ -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <select class="form-select" id="skill-category-filter">
                                            <option value="">ÊâÄÊúâÁ±ªÂà´</option>
                                            <option value="combat">ÊàòÊñó</option>
                                            <option value="magic">È≠îÊ≥ï</option>
                                            <option value="social">Á§æ‰∫§</option>
                                            <option value="mental">Á≤æÁ•û</option>
                                            <option value="physical">‰ΩìËÉΩ</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="skill-search" placeholder="ÊêúÁ¥¢ÊäÄËÉΩ...">
                                    </div>
                                </div>

                                <!-- ÊäÄËÉΩÂàóË°® -->
                                <div id="skills-container" class="skills-grid">
                                    <div class="text-center p-4">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Âä†ËΩΩ‰∏≠...</span>
                                        </div>
                                        <p class="mt-2 text-muted">Ê≠£Âú®Âä†ËΩΩÊäÄËÉΩ...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- ÊàêÂ∞±Â±ïÁ§∫Ê†áÁ≠æÈ°µ -->
                            <div class="tab-pane fade" id="achievements-tab">
                                <h6 class="mb-3">ÊàêÂ∞±Á≥ªÁªü</h6>
                                <div id="achievements-container" class="achievements-grid">
                                    <div id="achievements-container" class="achievements-grid">
                                        <div class="text-center p-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Âä†ËΩΩÊàêÂ∞±...</span>
                                            </div>
                                            <p class="mt-2 text-muted">Ê≠£Âú®Âä†ËΩΩÊàêÂ∞±Êï∞ÊçÆ...</p>
                                        </div>
                                    </div>
                                    <div class="achievement-category mb-4">
                                        <h6 class="achievement-category-title">
                                            <i class="bi bi-book"></i> ÊïÖ‰∫ãÊé¢Á¥¢
                                        </h6>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="achievement-item">
                                                    <div class="achievement-icon">üèÉ</div>
                                                    <div class="achievement-info">
                                                        <div class="achievement-name">ÂàùÊù•‰πçÂà∞</div>
                                                        <div class="achievement-desc">ÂÆåÊàêÁ¨¨‰∏Ä‰∏™Âú∫ÊôØ</div>
                                                        <div class="achievement-progress">
                                                            <div class="progress">
                                                                <div class="progress-bar" role="progressbar"
                                                                    style="width: 100%"></div>
                                                            </div>
                                                            <span class="progress-text">1/1</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="achievement-item locked">
                                                    <div class="achievement-icon">üé≠</div>
                                                    <div class="achievement-info">
                                                        <div class="achievement-name">ËßíËâ≤‰∏ìÂÆ∂</div>
                                                        <div class="achievement-desc">‰∏é10‰∏™‰∏çÂêåËßíËâ≤ÂØπËØù</div>
                                                        <div class="achievement-progress">
                                                            <div class="progress">
                                                                <div class="progress-bar" role="progressbar"
                                                                    style="width: 60%"></div>
                                                            </div>
                                                            <span class="progress-text">6/10</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ê∑ªÂä†ÈÅìÂÖ∑Ê®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="addItemModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ê∑ªÂä†Êñ∞ÈÅìÂÖ∑</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addItemForm">
                        <!-- Âú®Ë°®ÂçïÂ≠óÊÆµ‰∏ãÊ∑ªÂä†È™åËØÅÊèêÁ§∫ -->
                        <div class="mb-3">
                            <label for="itemName" class="form-label">ÈÅìÂÖ∑ÂêçÁß∞ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="itemName" required>
                            <div class="invalid-feedback">
                                ËØ∑ËæìÂÖ•ÈÅìÂÖ∑ÂêçÁß∞
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="itemDescription" class="form-label">ÊèèËø∞</label>
                            <textarea class="form-control" id="itemDescription" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="itemCategory" class="form-label">Á±ªÂà´</label>
                                <select class="form-select" id="itemCategory" required>
                                    <option value="">ÈÄâÊã©Á±ªÂà´</option>
                                    <option value="weapon">Ê≠¶Âô®</option>
                                    <option value="armor">Èò≤ÂÖ∑</option>
                                    <option value="accessory">È•∞ÂìÅ</option>
                                    <option value="consumable">Ê∂àËÄóÂìÅ</option>
                                    <option value="tool">Â∑•ÂÖ∑</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="itemRarity" class="form-label">Á®ÄÊúâÂ∫¶</label>
                                <select class="form-select" id="itemRarity" required>
                                    <option value="">ÈÄâÊã©Á®ÄÊúâÂ∫¶</option>
                                    <option value="common">ÊôÆÈÄö</option>
                                    <option value="uncommon">‰∏çÂ∏∏ËßÅ</option>
                                    <option value="rare">Á®ÄÊúâ</option>
                                    <option value="epic">Âè≤ËØó</option>
                                    <option value="legendary">‰º†ËØ¥</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">ÊïàÊûúÈÖçÁΩÆ</label>
                            <div id="itemEffects">
                                <div class="effect-item row g-2 mb-2">
                                    <div class="col-md-2">
                                        <select class="form-select effect-target" required>
                                            <option value="">ÈÄâÊã©ÁõÆÊ†á</option>
                                            <option value="self">Ëá™Â∑±</option>
                                            <option value="other">ÂÖ∂‰ªñËßíËâ≤</option>
                                            <option value="scene">Âú∫ÊôØ</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select effect-type" required>
                                            <option value="">ÈÄâÊã©Á±ªÂûã</option>
                                            <optgroup label="Âü∫Á°ÄÂ±ûÊÄß">
                                                <option value="health">ÁîüÂëΩÂÄº</option>
                                                <option value="mana">Ê≥ïÂäõÂÄº</option>
                                                <option value="energy">Á≤æÂäõ</option>
                                            </optgroup>
                                            <optgroup label="ÊàòÊñóÂ±ûÊÄß">
                                                <option value="attack">ÊîªÂáªÂäõ</option>
                                                <option value="defense">Èò≤Âæ°Âäõ</option>
                                                <option value="speed">ÈÄüÂ∫¶</option>
                                            </optgroup>
                                            <optgroup label="Á§æ‰∫§Â±ûÊÄß">
                                                <option value="mood">ÂøÉÊÉÖ</option>
                                                <option value="charisma">È≠ÖÂäõ</option>
                                                <option value="luck">ËøêÊ∞î</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <input type="number" class="form-control effect-value" placeholder="Êï∞ÂÄº"
                                            min="-100" max="100" required>
                                    </div>
                                    <div class="col-md-2">
                                        <input type="number" class="form-control effect-probability" placeholder="Ê¶ÇÁéá"
                                            min="0" max="1" step="0.1" value="1" required>
                                    </div>
                                    <div class="col-md-2">
                                        <input type="number" class="form-control effect-duration" placeholder="ÊåÅÁª≠Êó∂Èó¥(Áßí)"
                                            min="0" value="0">
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn btn-outline-danger btn-sm remove-effect-btn">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addEffectRow()">
                                <i class="bi bi-plus"></i> Ê∑ªÂä†ÊïàÊûú
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                    <button type="button" class="btn btn-primary" onclick="saveItem()">‰øùÂ≠òÈÅìÂÖ∑</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ê∑ªÂä†ÊäÄËÉΩÊ®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="addSkillModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ê∑ªÂä†Êñ∞ÊäÄËÉΩ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addSkillForm">
                        <div class="mb-3">
                            <label for="skillName" class="form-label">ÊäÄËÉΩÂêçÁß∞</label>
                            <input type="text" class="form-control" id="skillName" required>
                        </div>
                        <div class="mb-3">
                            <label for="skillDescription" class="form-label">ÊèèËø∞</label>
                            <textarea class="form-control" id="skillDescription" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <label for="skillCategory" class="form-label">Á±ªÂà´</label>
                                <select class="form-select" id="skillCategory" required>
                                    <option value="">ÈÄâÊã©Á±ªÂà´</option>
                                    <option value="combat">‚öîÔ∏è ÊàòÊñó</option>
                                    <option value="magic">üîÆ È≠îÊ≥ï</option>
                                    <option value="social">üí¨ Á§æ‰∫§</option>
                                    <option value="mental">üß† Á≤æÁ•û</option>
                                    <option value="physical">üí™ ‰ΩìËÉΩ</option>
                                    <option value="crafting">üî® Âà∂‰Ωú</option>
                                    <option value="survival">üèïÔ∏è ÁîüÂ≠ò</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="skillCooldown" class="form-label">ÂÜ∑Âç¥Êó∂Èó¥(Áßí)</label>
                                <input type="number" class="form-control" id="skillCooldown" min="0" value="0">
                            </div>
                            <div class="col-md-4">
                                <label for="skillManaCost" class="form-label">Ê≥ïÂäõÊ∂àËÄó</label>
                                <input type="number" class="form-control" id="skillManaCost" min="0" value="0">
                            </div>
                        </div>

                        <!-- ÊäÄËÉΩÊïàÊûúÈÖçÁΩÆ -->
                        <div class="mt-3">
                            <label class="form-label">ÊäÄËÉΩÊïàÊûú</label>
                            <div id="skillEffects">
                                <!-- ÈªòËÆ§ÊïàÊûúË°å -->
                                <div class="effect-item row g-2 mb-2">
                                    <!-- ... ÊïàÊûúÈÖçÁΩÆÂ≠óÊÆµ -->
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addSkillEffectRow()">
                                <i class="bi bi-plus"></i> Ê∑ªÂä†ÊïàÊûú
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                    <button type="button" class="btn btn-primary" onclick="saveSkill()">‰øùÂ≠òÊäÄËÉΩ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Êñá‰ª∂ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app-loader.js"></script>

    <script>
        // ÂàùÂßãÂåñÁî®Êà∑Ê°£Ê°àÁ≥ªÁªü
        document.addEventListener('DOMContentLoaded', function () {
            // Á≠âÂæÖ UserProfile Á±ªÂä†ËΩΩÂÆåÊàê
            if (typeof window.userProfile !== 'undefined') {
                window.userProfile.init('user_default');
            } else {
                // Âª∂ËøüÈáçËØï
                setTimeout(() => {
                    if (typeof window.userProfile !== 'undefined') {
                        window.userProfile.init('user_default');
                    }
                }, 100);
            }

            // ‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâòÔºåÈÅøÂÖçÁõ¥Êé•Ë∞ÉÁî®ÂÖ®Â±ÄÂáΩÊï∞
            document.addEventListener('click', function (e) {
                if (e.target.matches('.btn[onclick*="showAddItemModal"]')) {
                    e.preventDefault();
                    window.userProfile?.showModal('addItemModal');
                }

                if (e.target.matches('.btn[onclick*="saveItem"]')) {
                    e.preventDefault();
                    window.userProfile?.saveNewItem();
                }

                if (e.target.matches('.btn[onclick*="saveSkill"]')) {
                    e.preventDefault();
                    window.userProfile?.saveNewSkill();
                }
            });
        });
    </script>
</body>

</html>
{{end}}
